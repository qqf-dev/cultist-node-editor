<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>节点编辑器</title>

    <!-- 根目录 CSS：变量、基础样式、布局 -->
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/layout.css" />

    <!-- 工具类 CSS -->
    <link rel="stylesheet" href="css/utils/status.css" />
    <link rel="stylesheet" href="css/utils/layout_tools.css" />

    <!-- 组件 CSS（按需调整顺序） -->
    <link rel="stylesheet" href="css/components/connections.css" />
    <link rel="stylesheet" href="css/components/menus.css" />
    <link rel="stylesheet" href="css/components/nodes.css" />
    <link rel="stylesheet" href="css/components/other.css" />
    <link rel="stylesheet" href="css/components/ports.css" />
    <link rel="stylesheet" href="css/components/properties.css" />
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <div class="node-palette">
          <h3>节点类型</h3>
          <button class="btn-node-type" onclick="addNode('recipes')">
            📖 recipe
          </button>
          <button class="btn-node-type" onclick="addNode('elements')">
            📇 element/aspect
          </button>
          <button class="btn-node-type" onclick="addNode('decks')">
            🗃 deck
          </button>
          <button class="btn-node-type" onclick="addNode('verbs')">
            ⚡ verb
          </button>
          <button class="btn-node-type" onclick="addNode('text')">
            📝 文本
          </button>
        </div>

        <div class="editor-palette">
          <h3>操作</h3>
          <button
            class="btn btn-secondary"
            style="width: auto"
            onclick="testCommunication()"
          >
            🔌 通讯测试
          </button>
          <button
            class="btn btn-secondary"
            style="width: auto"
            onclick="generateTest()"
          >
            🧪 生成测试
          </button>
          <button
            class="btn btn-secondary"
            style="width: auto"
            onclick="toggleConsole()"
          >
            🔍 控制台
          </button>
          <button
            class="btn btn-secondary"
            style="width: auto"
            onclick="customCheck()"
          >
            ⚙️ 自定义检测
          </button>
          <button class="btn btn-secondary" onclick="generateTest()">
            💾 保存为 JSON
          </button>
          <button class="btn btn-secondary" onclick="loadGraph()">
            📂 加载 JSON
          </button>
          <button
            id="btn-readMod"
            class="btn btn-secondary"
            onclick="readMod()"
          >
            🔧 读取mod
          </button>
          <button class="btn" onclick="clearCanvas()">🗑️ 清空画布</button>
        </div>

        <!-- 调试生成任意节点 -->
        <div
          style="
            margin-top: 12px;
            border-top: 1px solid #444;
            padding-top: 10px;
          "
        >
          <h4 style="margin: 0 0 8px 0; font-size: 14px; color: #ffaa00">
            调试
          </h4>
          <div style="display: flex; gap: 5px">
            <select
              id="debugNodeSelect"
              style="
                flex: 1;
                padding: 6px;
                background: #2a2a2a;
                color: #eee;
                border: 1px solid #555;
                border-radius: 4px;
                width: 50%;
              "
            >
              <!-- 选项由JavaScript动态生成，包含nodeTypes.js中所有节点 -->
            </select>
            <button
              class="btn btn-secondary"
              style="width: auto"
              onclick="addSelectedDebugNode()"
            >
              添加
            </button>
          </div>
        </div>

        <div class="node-palette">
          <h3>状态</h3>
          <div id="status">等待命令...</div>
          <span id="canvas-scale-display" style="margin-left: auto">100%</span>
        </div>
      </div>

      <div class="editor-area">
        <div class="toolbar">
          <button class="btn" style="width: auto" onclick="addTestNode()">
            添加测试节点
          </button>
          <button class="btn" style="width: auto" onclick="addBlankNode()">
            引入json文件
          </button>
          <button class="btn" style="width: auto" onclick="addTestNode()">
            引入素材文件
          </button>
          <button class="btn" style="width: auto" onclick="addTestNode()">
            原版游戏文件（！如果修改过请引用修改后的文件）
          </button>
          <span style="margin-left: auto; font-size: 12px; color: #888"
            >节点编辑器 v0.1</span
          >
        </div>

        <div class="canvas-viewport" id="canvas-container">
          <div class="canvas-world" id="canvas">
            <!-- 这里将显示节点 -->
            <div
              id="placeholder"
              style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
                color: #666;
              "
            >
              <div style="font-size: 48px; margin-bottom: 16px">🧩</div>
              <div style="font-size: 16px; margin-bottom: 8px">
                节点编辑器已就绪
              </div>
              <div style="font-size: 12px">
                从左侧面板添加节点，或点击上方按钮添加测试节点
              </div>
            </div>
          </div>
        </div>

        <div class="status-bar">
          <span id="status-text">就绪</span>
          <span
            id="mouse-coords"
            style="margin-left: auto; font-family: monospace"
          >
            (0,0) | (0,0)
          </span>
        </div>
      </div>
    </div>
  </body>
  <script src="scripts/basicManager.js"></script>
  <script src="scripts/nodeTypes.js"></script>
  <script src="scripts/node.js"></script>
  <script src="scripts/nodeManager.js"></script>
  <script src="scripts/index.js"></script>
  <script src="scripts/webview.js"></script>
</html>
